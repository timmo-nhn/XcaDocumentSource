using Microsoft.AspNetCore.Identity.Data;
using XcaXds.Commons.Commons;
using XcaXds.Commons.Extensions;

namespace XcaXds.Tests;

public class UnitTests_Functionalities
{
    [Fact]
    public async Task ParseNorwegianNationalIdentifiers()
    {
        var nins = new[]
        {
            new { Value = "65739381163", AssignedAuthority = Constants.Oid.Dnr, Excpected = DateTime.Parse("09.03.1889") }, // (09.03.1889) RUND JUKEBOKS
            new { Value = "05020279712", AssignedAuthority = Constants.Oid.Fnr, Excpected = DateTime.Parse("05.02.2002") }, // (05.02.2002) Tim Fnr
            new { Value = "13116900216", AssignedAuthority = Constants.Oid.Fnr, Excpected = DateTime.Parse("13.11.1969") }, // (13.11.1969) Line Danser - Normal Fnr
            new { Value = "53116900216", AssignedAuthority = Constants.Oid.Dnr, Excpected = DateTime.Parse("13.11.1969") }, // (13.11.1969) Line Danser - D-number: Day + 40        
            new { Value = "13516900216", AssignedAuthority = Constants.Oid.Hnr, Excpected = DateTime.Parse("13.11.1969") }, // (13.11.1969) Line Danser - H-number: Month + 40
            new { Value = "13916900216", AssignedAuthority = Constants.Oid.Fnr, Excpected = DateTime.Parse("13.11.1969") }, // (13.11.1969) Line Danser - +80 Synthetic Normal
            new { Value = "53916900216", AssignedAuthority = Constants.Oid.Dnr, Excpected = DateTime.Parse("13.11.1969") }, // (13.11.1969) Line Danser - +80 Synthetic D-number: Day + 40
            new { Value = "13766900216", AssignedAuthority = Constants.Oid.Fnr, Excpected = DateTime.Parse("13.11.1969") }, // (13.11.1969) Line Danser - +65 Synthetic Normal
            new { Value = "53766900216", AssignedAuthority = Constants.Oid.Dnr, Excpected = DateTime.Parse("13.11.1969") }, // (13.11.1969) Line Danser - +65 Synthetic D-number: Day + 40
            new { Value = "02835998374", AssignedAuthority = Constants.Oid.Fnr, Excpected = DateTime.Parse("02.03.1959") }, // (02.03.1959) AUTORISERT JUL
            new { Value = "17855599120", AssignedAuthority = Constants.Oid.Fnr, Excpected = DateTime.Parse("17.05.1955") }, // (17.05.1955) USNOBBET KLOKKE
            new { Value = "08777634659", AssignedAuthority = Constants.Oid.Fnr, Excpected = DateTime.Parse("08.12.1976") }, // (08.12.1976) ULYDIG BOLLE
            new { Value = "29870049887", AssignedAuthority = Constants.Oid.Fnr, Excpected = DateTime.Parse("29.07.1900") }, // (29.07.1900) SIVILISERT ANTILOPE
            new { Value = "16910948990", AssignedAuthority = Constants.Oid.Fnr, Excpected = DateTime.Parse("16.11.1909") }, // (16.11.1909) BARMHJERTIG BØK
            new { Value = "22810999865", AssignedAuthority = Constants.Oid.Fnr, Excpected = DateTime.Parse("22.01.2009") }, // (22.01.2009) FORSKJELLIG ANALYSE
            new { Value = "09838973652", AssignedAuthority = Constants.Oid.Fnr, Excpected = DateTime.Parse("09.03.1889") }, // (09.03.1889) RUND JUKEBOKS

        };

        var nins2 = new[]
        {
            "07036737934",
            "15078912720",
            "04091224599",
            "21066438853",
            "15098129380",
            "23099022574",
            "03102718207",
            "08036392828",
            "03098140297",
            "14027839887",
            "11095048813",
            "30018809237",
            "10011847248",
            "31030733528",
            "21018593103",
            "04103422332",
            "29062417267",
            "11026097284",
            "25076912907",
            "31127741797",
            "29090827136",
            "07123623317",
            "24110288871",
            "14105008989",
            "01098104360",
            "05031202118",
            "23037614874",
            "19124026264",
            "22106592865",
            "25028405599",
            "09128044059",
            "23041723661",
            "05047414697",
            "18078746382",
            "26095027112",
            "22114310097",
            "11033714167",
            "23044838001",
            "09051238599",
            "29021637317",
            "01037918829",
            "20057824094",
            "17092136205",
            "11042309755",
            "10108903746",
            "06119406518",
            "23015913592",
            "07040545470",
            "10129397220",
            "02077291159",
            "09072248055",
            "20098821954",
            "11072413352",
            "22041606219",
            "27061536170",
            "09129040731",
            "18097293801",
            "04038106843",
            "02070285110",
            "07010045244",
            "07023336345",
            "04127115023",
            "11089436089",
            "01044617583",
            "19053022246",
            "03016029849",
            "07040436361",
            "07050110855",
            "28048820427",
            "30113306374",
            "24113100628",
            "03062219512",
            "26086327375",
            "26064238689",
            "15099122088",
            "01121631640",
            "25014322534",
            "31010732835",
            "02099321248",
            "22075930058",
            "19085636777",
            "10120209383",
            "25058731326",
            "16115493675",
            "09083318187",
            "27013014499",
            "16031104541",
            "03095243451",
            "25075532345",
            "18073908414",
            "05047836869",
            "19061035985",
            "14067137052",
            "24029044186",
            "05050219978",
            "06047323450",
            "26056204392",
            "06098835154",
            "25097536565",
            "11037131557",
            "24063929863",
            "10056390370",
            "10064840032",
            "17123017099",
            "10099001939",
            "06085810500",
            "07103149724",
            "19128546459",
            "31082141076",
            "18064711314",
            "16088690617",
            "05061922735",
            "23024925528",
            "05113726417",
            "25094997162",
            "20046111363",
            "05123838906",
            "11109602614",
            "30119843231",
            "14052546002",
            "05085729421",
            "04027503409",
            "19063527702",
            "31032323890",
            "31086226475",
            "13040172968",
            "11036115353",
            "04029245393",
            "22129199672",
            "19023000663",
            "03098337910",
            "24117238683",
            "03047499193",
            "30068834984",
            "07097805339",
            "09101125537",
            "08061333593",
            "05040537017",
            "06055643553",
            "30039799975",
            "02014421540",
            "01030920518",
            "12042347572",
            "11028890704",
            "09105210520",
            "26024712736",
            "21127815841",
            "23051514440",
            "23082248153",
            "22085249820",
            "11087509879",
            "05027907190",
            "04059930430",
            "15080803181",
            "29059509657",
            "01023442120",
            "29071832099",
            "28119721387",
            "03012848268",
            "24035540055",
            "12056191958",
            "19122337289",
            "09013336323",
            "03127790700",
            "26105614550",
            "19077893019",
            "24079129522",
            "14089244197",
            "04073739832",
            "28104592157",
            "03031012332",
            "14104149120",
            "05025743808",
            "13093449864",
            "25098719213",
            "11099308909",
            "14020443422",
            "21050536995",
            "02103126161",
            "28036993083",
            "15122032393",
            "16036195936",
            "29015395433",
            "16067925509",
            "28020623294",
            "04063737246",
            "26022537740",
            "03110273699",
            "24088848329",
            "06054149997",
            "24026015673",
            "21053240361",
            "19076896723",
            "16121227189",
            "05051741007",
            "25023736988",
            "10071133600",
            "30097736401",
            "08036520990",
            "12054000284",
            "22065733173",
            "04116132074",
            "24113522476",
            "24087949024",
            "07039303854",
            "07026906347",
            "31058311351",
            "16032402430",
            "21074544182",
            "28024010343",
            "06025705635",
            "03107391702",
            "07013325922",
            "19114406646",
            "21117746965",
            "06099818032",
            "07085538718",
            "14108438844",
            "02035414390",
            "09120275442",
            "23032138624",
            "25115616946",
            "27100308555",
            "14069592415",
            "24124000978",
            "06056741400",
            "01124734521",
            "21025730108",
            "07039092063",
            "28085342888",
            "14053645349",
            "05040206878",
            "06016341639",
            "22017220156",
            "18067809986",
            "20118911416",
            "12113325532",
            "20013305723",
            "12093701621",
            "06066141223",
            "17034840369",
            "12058929865",
            "20110344369",
            "17128949682",
            "23105532547",
            "28070843554",
            "03099644655",
            "01074206561",
            "22011931808",
            "06061101746",
            "24072124991",
            "13034046489",
            "06122707448",
            "01062802185",
            "07087826591",
            "01086536125",
            "15121727800",
            "25128739338",
            "03088304119",
            "14111501387",
            "24011245834",
            "06077892751",
            "03053930270",
            "02114129731",
            "03064243453",
            "30080827438",
            "17090740709",
            "23018546558",
            "03120400877",
            "24128821747",
            "29062107241",
            "03029135613",
            "28112819624",
            "20091026482",
            "19094146707",
            "01016149302",
            "20110508361",
            "08015426641",
            "13090243491",
            "06128515346",
            "11028930315",
            "30016803096",
            "26025826174",
            "09048948232",
            "16050807758",
            "17046440765",
            "01097096054",
            "15051801129",
            "19105434319",
            "10121922970",
            "16086734889",
            "08026607036",
            "23086535009",
            "22128444878",
            "22043527588",
            "19125931084",
            "07032128909",
            "26038595503",
            "12114827051",
            "13067237034",
            "03034003733",
            "08030155832",
            "21105813047",
            "10100261427",
            "21016895382",
            "09114700190",
            "13057906299",
            "24079246774",
            "16048448201",
            "12121813678",
            "19051121174",
            "01012446558",
            "21098327417",
            "18075209742",
            "17053145280",
            "25100933937",
            "28038306601",
            "30115508292",
            "07040618621",
            "24060942583",
            "12065905238",
            "26045947741",
            "25046597004",
            "17108232382",
            "20034595748",
            "29039318219",
            "02065020842",
            "14054526971",
            "04023429271",
            "15058949202",
            "11073915467",
            "18121508210",
            "19012145260",
            "08040513672",
            "17083345454",
            "13016992091",
            "24041627278",
            "13075827444",
            "02053643399",
            "03032207498",
            "30115649139",
            "19047696901",
            "20110078588",
            "17042714062",
            "06045400776",
            "02035819927",
            "08056832301",
            "08086244935",
            "23129744626",
            "14049607882",
            "28034143228",
            "10126721086",
            "29104601691",
            "06019925615",
            "08051322232",
            "25088033895",
            "27090024235",
            "30112142424",
            "19111515851",
            "16098631171",
            "08022724437",
            "07010706275",
            "06066632200",
            "29080032356",
            "15017747433",
            "27038549389",
            "20106424757",
            "01066332949",
            "16026234097",
            "06115295835",
            "13044000223",
            "10037048629",
            "07049636347",
            "20109532704",
            "21080215921",
            "04083526357",
            "04120401438",
            "12100281854",
            "13020828913",
            "30074804620",
            "03102909231",
            "22025929962",
            "14079202135",
            "14073933146",
            "10016421095",
            "16052825052",
            "01011526787",
            "21108837664",
            "27071313560",
            "01121738801",
            "26096406567",
            "09118706983",
            "16031726593",
            "07063743466",
            "12058392659",
            "15112926663",
            "02103637336",
            "06013324776",
            "19031126404",
            "26030034219",
            "14028222182",
            "04021735057",
            "18091208764",
            "25071649051",
            "09116731271",
            "13050645244",
            "04075894738",
            "03054310772",
            "26065749296",
            "07042133218",
            "24119504925",
            "22052240534",
            "19108640467",
            "29077646343",
            "24091137115",
            "25023345164",
            "27080018032",
            "20068094942",
            "28039296189",
            "23062221402",
            "30015502726",
            "04019339454",
            "19045434926",
            "27105007154",
            "05104790390",
            "27012610616",
            "15052101473",
            "18030811433",
            "04069705559",
            "08067825676",
            "25057924414",
            "27066697407",
            "11037247059",
            "28115496761",
            "08100736250",
            "30105914993",
            "05028939541",
            "05035114183",
            "26063224161",
            "23019824411",
            "18060170165",
            "07096538140",
            "10077794374",
            "21034204109",
            "24017743968",
            "29108516370",
            "24011037174",
            "07111238094",
            "14077900285",
            "16059743205",
            "19029241409",
            "14121608961",
            "13047109560",
            "11113929792",
            "28085819005",
            "06040328430",
            "17031049326",
            "05037995810",
            "24023420496",
            "02010518140",
            "23096502559",
            "06125397342",
            "02016500294",
            "24079145536",
            "15118435645",
            "12068644931",
            "03028443780",
            "12035946355",
            "24086830961",
            "14048534784",
            "20037797937",
            "18064091642",
            "30010508394",
            "22021307665",
            "14101736041",
            "20016244792",
            "31123228904",
            "06010916826",
            "21048244758",
            "28026536695",
            "23129022582",
            "29081610787",
            "18061122776",
            "26091313773",
            "13107429527",
            "26060201004",
            "09126422110",
            "22062922293",
            "14017313925",
            "02073507580",
            "24076232039",
            "04073249991",
            "20102325274",
            "06038918832",
            "07042203402",
            "12059241859",
            "31126837316",
            "06039610289",
            "24079800968",
            "15035042382"
        };

        foreach (var nin in nins2)
        {
            var parsedNin = Hl7FhirExtensions.ParseNorwegianNinToCxWithAssigningAuthority(nin);
        }

        foreach (var nin in nins)
        {
            var parsedNin = Hl7FhirExtensions.ParseNorwegianNinToCxWithAssigningAuthority(nin.Value);

            var dateTimeFromNin = Hl7FhirExtensions.ParseNorwegianNinToDateTime(parsedNin);

            Assert.Equal(nin.Excpected, dateTimeFromNin);

            Assert.Equal(nin.AssignedAuthority, parsedNin?.AssigningAuthority?.UniversalId);
        }
    }

    [Fact]
    public async Task UniqueGuid()
    {
        var guid = Guid.NewGuid().ToString();
        var guidFirstPart = guid.Substring(0, 6);

        var secondGuid = Guid.NewGuid().ToString();
        var secondGuidFirstPart = secondGuid.Substring(0, 6);

        var counter = 0;

        while (!string.Equals(guidFirstPart, secondGuidFirstPart))
        {
            secondGuid = Guid.NewGuid().ToString();
            secondGuidFirstPart = secondGuid.Substring(0, 6);
            counter++;
        }
    }
}
